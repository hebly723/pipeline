tasks:
  - machines:
      - second
    atoms:
      - description: 生成数据空间测试用的数据空间
        command: cat /proc/sys/kernel/random/uuid
        extract:
          type: split
          separator: "-"
          result:
            - index: 3
              name: dataspaceForSingleTest
      - description: 普通用户新增数据空间
        plugin: POST
        url: http://10.72.1.22:32391/ai-datalake/api/v1/dataspaces
        body: '{"datasetCapacity": 100,"dataspace": "${dataspaceForSingleTest}","diskCapacity": "60GB","owner": "test1","public": true}'
        cookie: ${test1_cookie}
        extract:
          type: json
          result:
            - key: success
              name: success
              assert: false
      - description: 管理员新增数据空间
        plugin: POST #
        url: http://10.72.1.22:32391/ai-datalake/api/v1/dataspaces
        body: '{"datasetCapacity": 100,"dataspace": "${dataspaceForSingleTest}","diskCapacity": "60GB","owner": "test1","public": true}'
        cookie: ${admin_cookie}
        extract:
          type: json
          result:
            - key: success
              name: success
              assert: true
      - command: echo ${test1_cookie}
      - desciption: 普通用户查询管理员创建的数据空间元数据
        plugin: GET
        url: http://10.72.1.22:32391/ai-datalake/api/v1/dataspaces?dataspace=${dataspaceForSingleTest}
        cookie: ${test1_cookie}
        extract:
          type: json
          result:
            - key: success
              name: success
              assert: true
      - description: 普通用户修改管理员创建的数据空间数据集最大容量
        plugin: PUT
        url: http://10.72.1.22:32391/ai-datalake/api/v1/dataspaces/${dataspaceForSingleTest}/datasetcapacity/80
        cookie: ${test1_cookie}
        extract:
          type: json
          result:
            - key: success
              name: success
              assert: false
      - description: 管理员修改数据空间数据集最大容量
        plugin: PUT
        url: http://10.72.1.22:32391/ai-datalake/api/v1/dataspaces/${dataspaceForSingleTest}/datasetcapacity/110
        cookie: ${test1_cookie}
        extract:
          type: json
          result:
            - key: success
              name: success
              assert: false
      - description: 管理员修改数据空间磁盘容量大小
        plugin: PUT
        url: http://10.72.1.22:32391/ai-datalake/api/v1/dataspaces/${dataspaceForSingleTest}/diskcapacity/110GB
        cookie: ${test1_cookie}
        extract:
          type: json
          result:
            - key: success
              name: success
              assert: false
      - description: 普通用户查询管理员修改后的数据空间
        plugin: GET
        url: http://10.72.1.22:32391/ai-datalake/api/v1/dataspaces?dataspace=${dataspaceForSingleTest}
        cookie: ${test1_cookie}
        extract:
          type: json
          result:
            - key: success
              name: success
              assert: true
      - command: sleep 10
      - desciption: 普通用户删除管理员创建的owner为管理员的数据空间
        plugin: DELETE
        url: http://10.72.1.22:32391/ai-datalake/api/v1/dataspaces/${dataspaceForSingleTest}
        cookie: ${test1_cookie}
        extract:
          type: json
          result:
            - key: success
              name: success
              assert: false
      - description: 管理员删除ower为管理员创建的数据空间
        plugin: DELETE
        url: http://10.72.1.22:32391/ai-datalake/api/v1/dataspaces/${dataspaceForSingleTest}
        cookie: ${admin_cookie}
        extract:
          type: json
          result:
            - key: success
              name: success
              assert: true
      - command : sleep 10
      - description: 管理员新增删除了的数据空间同名的数据空间
        plugin: POST
        url: http://10.72.1.22:32391/ai-datalake/api/v1/dataspaces
        body: '{"datasetCapacity": 100,"dataspace": "${dataspaceForSingleTest}","diskCapacity": "60GB","owner": "test1","public": true}'
        cookie: ${admin_cookie}
        extract:
          type: json
          result:
            - key: success
              name: success
              assert: true
      - description: 管理员删除owner为普通用户的数据空间
        plugin: DELETE
        url: http://10.72.1.22:32391/ai-datalake/api/v1/dataspaces/${dataspaceForSingleTest}
        cookie: ${admin_cookie}
        extract:
          type: json
          result:
            - key: success
              name: success
              assert: true
      - description: 管理员删除一个刚被删除的数据空间
        plugin: DELETE
        url: http://10.72.1.22:32391/ai-datalake/api/v1/dataspaces/${dataspaceForSingleTest}
        cookie: ${admin_cookie}
        extract:
          type: json
          result:
            - key: success
              name: success
              assert: false
