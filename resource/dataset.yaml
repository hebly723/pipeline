tasks:
  - machines:
      - second
    atoms:
      - decription: 管理员新增非结构化数据集
        plugin: POST
        url: http://10.72.1.22:32391/ai-datalake/api/v1/dataspaces/${dataspace}/datasets
        body: '{"dataset":"${dataset}","dataspace":"${dataspace}","labelSchema":{"columns":[{"name":"image_md5","type":"string","comment":"图像文件的MD5值","nullable":false},{"name":"image_fname","type":"string","comment":"图像文件的文件名","nullable":false},{"name":"labels","type":"string","comment":"文件的标注数据","nullable":false}]},"owner":"test1","type":"unstructed"}'
        cookie: ${admin_cookie}
        extract:
          type: json
          result:
            - key: success
              name: success
              assert: true
      - description: 管理员新增结构化数据集
        plugin: POST
        url: http://10.72.1.22:32391/ai-datalake/api/v1/dataspaces/${dataspace}/datasets
        body: '{"dataset":"${dataset}Jiegou","dataspace":"${dataspace}","labelSchema":{"columns":[{"name":"image_md5","type":"string","comment":"图像文件的MD5值","nullable":false},{"name":"image_fname","type":"string","comment":"图像文件的文件名","nullable":false},{"name":"labels","type":"string","comment":"文件的标注数据","nullable":false}]},"owner":"test1","type":"structured"}'
        cookie: ${admin_cookie}
        extract:
          type: json
          result:
            - key: success
              name: success
              assert: true
      - description: 普通用户查询非结构化数据集
        plugin: GET
        url: http://10.72.1.22:32391/ai-datalake/api/v1/dataspaces/${dataspace}/datasets/${dataset}
        cookie: ${test1_cookie}
        extract:
          type: json
          result:
            - key: success
              name: success
              assert: true
      - description: 普通用户将非结构化数据集克隆到同个空间
        plugin: POST
        url: http://10.72.1.22:32391/ai-datalake/api/v1/clone-datasets
        body: '{ "owner": "test1", "sinkDataSet": "${dataset}1", "sinkDataSpace": "${dataspace}", "sourceDataSet": "${dataset}", "sourceDataSpace": "${dataspace}"}'
        cookie: ${test1_cookie}
        extract:
          type: json
          result:
            - key: success
              name: success
              assert: true
      - description: 普通用户查询非结构化克隆数据集
        plugin: GET
        url: http://10.72.1.22:32391/ai-datalake/api/v1/dataspaces/${dataspace}/datasets/${dataset}1
        cookie: ${test1_cookie}
        extract:
          type: json
          result:
            - key: success
              name: success
              assert: true
      - description: 普通用户删除非结构化克隆数据集
        plugin: DELETE
        url: http://10.72.1.22:32391/ai-datalake/api/v1/dataspaces/${dataspace}/datasets/${dataset}1
        cookie: ${test1_cookie}
        extract:
          type: json
          result:
            - key: success
              name: success
              assert: true
      - description: 管理员新增公开的数据空间
        plugin: POST
        url: http://10.72.1.22:32391/ai-datalake/api/v1/dataspaces
        body: '{"datasetCapacity": 100,"dataspace": "${dataspace}2","diskCapacity": "60GB","owner": "admin","public": true}'
        cookie: ${admin_cookie}
        extract:
          type: json
          result:
            - key: success
              name: success
              assert: true
      - description: 普通用户将自己的非结构化数据集克隆到管理员的空间
        plugin: POST
        url: http://10.72.1.22:32391/ai-datalake/api/v1/clone-datasets
        body: '{ "owner": "test1", "sinkDataSet": "${dataset}1", "sinkDataSpace": "${dataspace}2", "sourceDataSet": "${dataset}", "sourceDataSpace": "${dataspace}"}'
        cookie: ${test1_cookie}
        extract:
          type: json
          result:
            - key: success
              name: success
              assert: false
      - description: 管理员新增非结构化数据集
        plugin: POST
        url: http://10.72.1.22:32391/ai-datalake/api/v1/dataspaces/${dataspace}2/datasets
        body: '{"dataset":"${dataset}2","dataspace":"${dataspace}2","labelSchema":{"columns":[{"name":"image_md5","type":"string","comment":"图像文件的MD5值","nullable":false},{"name":"image_fname","type":"string","comment":"图像文件的文件名","nullable":false},{"name":"labels","type":"string","comment":"文件的标注数据","nullable":false}]},"owner":"admin","type":"unstructed"}'
        cookie: ${admin_cookie}
        extract:
          type: json
          result:
            - key: success
              name: success
              assert: true
      - description: 普通用户将管理员的非结构化数据集克隆到自己的空间
        plugin: POST
        url: http://10.72.1.22:32391/ai-datalake/api/v1/clone-datasets
        body: '{ "owner": "test1", "sinkDataSet": "${dataset}3", "sinkDataSpace": "${dataspace}", "sourceDataSet": "${dataset}2", "sourceDataSpace": "${dataspace}2"}'
        cookie: ${test1_cookie}
        extract:
          type: json
          result:
            - key: success
              name: success
              assert: true
      - description: 管理员新增非公开的数据空间
        plugin: POST
        url: http://10.72.1.22:32391/ai-datalake/api/v1/dataspaces
        body: '{"datasetCapacity": 100,"dataspace": "${dataspace}5","diskCapacity": "60GB","owner": "admin","public": false}'
        cookie: ${admin_cookie}
        extract:
          type: json
          result:
            - key: success
              name: success
              assert: true
      - description: 管理员新增非结构化数据集
        plugin: POST
        url: http://10.72.1.22:32391/ai-datalake/api/v1/dataspaces/${dataspace}5/datasets
        body: '{"dataset":"${dataset}2","dataspace":"${dataspace}5","labelSchema":{"columns":[{"name":"image_md5","type":"string","comment":"图像文件的MD5值","nullable":false},{"name":"image_fname","type":"string","comment":"图像文件的文件名","nullable":false},{"name":"labels","type":"string","comment":"文件的标注数据","nullable":false}]},"owner":"admin","type":"unstructed"}'
        cookie: ${admin_cookie}
        extract:
          type: json
          result:
            - key: success
              name: success
              assert: true
      - description: 普通用户将管理员的非结构化数据集克隆到自己的空间
        plugin: POST
        url: http://10.72.1.22:32391/ai-datalake/api/v1/clone-datasets
        body: '{ "owner": "test1", "sinkDataSet": "${dataset}90", "sinkDataSpace": "${dataspace}", "sourceDataSet": "${dataset}2", "sourceDataSpace": "${dataspace}5"}'
        cookie: ${test1_cookie}
        extract:
          type: json
          result:
            - key: success
              name: success
              assert: false
      - description: 普通用户删除非结构化数据集
        plugin: DELETE
        url: http://10.72.1.22:32391/ai-datalake/api/v1/dataspaces/${dataspace}/datasets/${dataset}
        cookie: ${test1_cookie}
        extract:
          type: json
          result:
            - key: success
              name: success
              assert: false
      - command: sleep 100
      - description: 管理员新增非结构化数据集
        plugin: POST
        url: http://10.72.1.22:32391/ai-datalake/api/v1/dataspaces/${dataspace}/datasets
        body: '{"dataset":"${dataset}","dataspace":"${dataspace}","labelSchema":{"columns":[{"name":"image_md5","type":"string","comment":"图像文件的MD5值","nullable":false},{"name":"image_fname","type":"string","comment":"图像文件的文件名","nullable":false},{"name":"labels","type":"string","comment":"文件的标注数据","nullable":false}]},"owner":"test1","type":"unstructed"}'
        cookie: ${admin_cookie}
        extract:
          type: json
          result:
            - key: success
              name: success
              assert: true
      - description: 普通用户查询非结构化数据集
        plugin: GET
        url: http://10.72.1.22:32391/ai-datalake/api/v1/dataspaces/${dataspace}/datasets/${dataset}
        cookie: ${test1_cookie}
        extract:
          type: json
          result:
            - key: success
              name: success
              assert: true
      - description: 普通用户删除非结构化数据集
        plugin: DELETE
        url: http://10.72.1.22:32391/ai-datalake/api/v1/dataspaces/${dataspace}/datasets/${dataset}
        cookie: ${test1_cookie}
        extract:
          type: json
          result:
            - key: success
              name: success
              assert: false
      - description: 普通用户新增结构化数据集
        plugin: POST
        url: http://10.72.1.22:32391/ai-datalake/api/v1/dataspaces/${dataspace}/datasets
        body: '{"dataset":"${dataset}","dataspace":"${dataspace}","labelSchema":{"columns":[{"name":"image_md5","type":"string","comment":"图像文件的MD5值","nullable":false},{"name":"image_fname","type":"string","comment":"图像文件的文件名","nullable":false},{"name":"labels","type":"string","comment":"文件的标注数据","nullable":false}]},"owner":"test1","type":"structed"}'
        cookie: ${test1_cookie}
        extract:
          type: json
          result:
            - key: success
              name: success
              assert: true
      - description: 普通用户查询结构化数据集
        plugin: GET
        url: http://10.72.1.22:32391/ai-datalake/api/v1/dataspaces/${dataspace}/datasets/${dataset}
        cookie: ${test1_cookie}
        extract:
          type: json
          result:
            - key: success
              name: success
              assert: true
      - description: 普通用户删除结构化数据集
        plugin: DELETE
        url: http://10.72.1.22:32391/ai-datalake/api/v1/dataspaces/${dataspace}/datasets/${dataset}
        cookie: ${test1_cookie}
        extract:
          type: json
          result:
            - key: success
              name: success
              assert: true
      - description: 管理员新增结构化数据集
        plugin: POST
        url: http://10.72.1.22:32391/ai-datalake/api/v1/dataspaces/${dataspace}/datasets
        body: '{"dataset":"${dataset}","dataspace":"${dataspace}2","labelSchema":{"columns":[{"name":"image_md5","type":"string","comment":"图像文件的MD5值","nullable":false},{"name":"image_fname","type":"string","comment":"图像文件的文件名","nullable":false},{"name":"labels","type":"string","comment":"文件的标注数据","nullable":false}]},"owner":"admin","type":"structed"}'
        cookie: ${admin_cookie}
        extract:
          type: json
          result:
            - key: success
              name: success
              assert: true
      - description: 普通用户查询结构化数据集
        plugin: GET
        url: http://10.72.1.22:32391/ai-datalake/api/v1/dataspaces/${dataspace}2/datasets/${dataset}
        cookie: ${test1_cookie}
        extract:
          type: json
          result:
            - key: success
              name: success
              assert: true
      - description: 普通用户删除结构化数据集
        plugin: DELETE
        url: http://10.72.1.22:32391/ai-datalake/api/v1/dataspaces/${dataspace}2/datasets/${dataset}
        cookie: ${test1_cookie}
        extract:
          type: json
          result:
            - key: success
              name: success
              assert: false
